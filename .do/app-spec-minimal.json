{
    "name": "qylon-multi-component",
    "region": "fra",
    "alerts": [
        {
            "rule": "DEPLOYMENT_FAILED"
        },
        {
            "rule": "DOMAIN_FAILED"
        }
    ],
    "features": [
        "buildpack-stack=ubuntu-22"
    ],
    "static_sites": [
        {
            "name": "frontend",
            "source_dir": "/",
            "github": {
                "repo": "KD-Squares/qylon",
                "branch": "main",
                "deploy_on_push": true
            },
            "build_command": "cd frontend && npm ci && npm run build",
            "output_dir": "frontend/dist",
            "catchall_document": "index.html",
            "index_document": "index.html",
            "envs": [
                {
                    "key": "VITE_SUPABASE_URL",
                    "value": "${SUPABASE_URL}"
                },
                {
                    "key": "VITE_SUPABASE_ANON_KEY",
                    "value": "${SUPABASE_ANON_KEY}"
                },
                {
                    "key": "VITE_API_URL",
                    "value": "https://qylon-app-f7utg.ondigitalocean.app/api"
                }
            ]
        }
    ],
    "services": [
        {
            "name": "api-gateway",
            "source_dir": "/",
            "github": {
                "repo": "KD-Squares/qylon",
                "branch": "main"
            },
            "build_command": "cd services/api-gateway && npm ci && npm run build",
            "run_command": "cd services/api-gateway && npm start",
            "environment_slug": "node-js",
            "instance_count": 1,
            "instance_size_slug": "basic-xxs",
            "http_port": 8080,
            "envs": [
                {
                    "key": "NODE_ENV",
                    "value": "production"
                },
                {
                    "key": "PORT",
                    "value": "8080"
                },
                {
                    "key": "JWT_SECRET",
                    "value": "${JWT_SECRET}"
                },
                {
                    "key": "SUPABASE_URL",
                    "value": "${SUPABASE_URL}"
                },
                {
                    "key": "SUPABASE_SERVICE_ROLE_KEY",
                    "value": "${SUPABASE_SERVICE_ROLE_KEY}"
                },
                {
                    "key": "SUPABASE_ANON_KEY",
                    "value": "${SUPABASE_ANON_KEY}"
                },
                {
                    "key": "OPENAI_API_KEY",
                    "value": "${OPENAI_API_KEY}"
                },
                {
                    "key": "RECALL_AI_API_KEY",
                    "value": "${RECALL_AI_API_KEY}"
                },
                {
                    "key": "CORS_ORIGIN",
                    "value": "${CORS_ORIGIN}"
                },
                {
                    "key": "SECURITY_HEADERS",
                    "value": "true"
                },
                {
                    "key": "HELMET_ENABLED",
                    "value": "true"
                },
                {
                    "key": "RATE_LIMIT_WINDOW_MS",
                    "value": "900000"
                },
                {
                    "key": "RATE_LIMIT_MAX_REQUESTS",
                    "value": "100"
                }
            ],
            "health_check": {
                "http_path": "/health",
                "initial_delay_seconds": 30,
                "period_seconds": 10,
                "timeout_seconds": 5,
                "success_threshold": 1,
                "failure_threshold": 3
            }
        }
    ]
}
